<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chill X — Staff Application</title>
  <style>
    :root{
      --bg:#05101a; --card:#071427; --neon:#00ffd5; --accent:#7c5cff; --muted:#9aa8b2;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:
      radial-gradient(900px 400px at 10% 10%, rgba(124,92,255,0.06), transparent),
      linear-gradient(180deg, rgba(0,0,0,0.6), rgba(3,6,10,0.9)),
      var(--bg); color:#e6f7f5; -webkit-font-smoothing:antialiased;}

    .wrap{max-width:980px;margin:28px auto;padding:20px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:22px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 40px rgba(2,6,12,0.6);display:grid;grid-template-columns:260px 1fr;gap:18px;align-items:start}
    .panel{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(0,0,0,0.06));border:1px solid rgba(255,255,255,0.02)}
    .logo{display:flex;flex-direction:column;align-items:center;gap:10px}
    .logo img{width:150px;height:150px;border-radius:14px;object-fit:cover;border:1px solid rgba(255,255,255,0.04)}
    h1{margin:0;font-size:20px}
    p.lead{margin:0;color:var(--muted)}

    form{display:grid;gap:12px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type=text],input[type=email],select,textarea,input[type=number]{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);padding:12px;border-radius:10px;color:inherit;outline:none;width:100%}
    textarea{min-height:100px;resize:vertical}
    .row{display:flex;gap:10px}
    .btn{display:inline-block;padding:12px 18px;border-radius:10px;background:linear-gradient(90deg,var(--neon),var(--accent));color:#02121a;font-weight:700;border:none;cursor:pointer;box-shadow:0 6px 26px rgba(124,92,255,0.12)}
    .btn[disabled]{opacity:0.5;cursor:not-allowed}
    .muted{color:var(--muted)}
    .capsule{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,0.02);display:inline-flex;gap:8px;align-items:center;border:1px solid rgba(255,255,255,0.02)}
    .note{font-size:13px;color:var(--muted)}
    .success{color:#8ef0a6}
    .error{color:#ff7373}
    @media(max-width:860px){.card{grid-template-columns:1fr;padding:16px}.logo{justify-content:center}}

    /* select styling to match dark theme (fix bright background on desktop) */
    .select-wrap{position:relative}
    select{color:var(--neon); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06)); padding-right: 40px; border-radius:8px}
    .select-wrap::after{content:'▾'; position:absolute; right:12px; top:50%; transform:translateY(-50%); pointer-events:none; color:var(--muted)}
    /* some desktop browsers ignore option styling, but this helps on most: */
    select option{color:var(--neon); background:var(--card)}

    /* make it slightly annoying to select / right click (cosmetic) */
    body{user-select:text}
    .no-select{user-select:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="panel logo">
        <img alt="Chill X Logo" src="https://images-ext-1.discordapp.net/external/mcL28drH0nyJCD4bcHUmlke8pJTPaa2C9sh7dHrpm5s/%3Fsize%3D1024/https/cdn.discordapp.com/icons/1425112529302192148/a_5049012ee1481686fb0452ccff641f99.gif?width=333&height=333">
        <h1>Chill X — Staff Application</h1>
        <p class="lead">Dark • Neon • AI theme — Mobile + Desktop</p>

        <div style="width:100%;text-align:center;margin-top:8px">
          <div id="status" class="capsule muted">Initializing...</div>
        </div>

        <div style="width:100%;margin-top:10px;text-align:center">
          <small class="note">All fields with * are required • CAPTCHA required • Submissions limited to 1 per 48 hours</small>
        </div>
      </div>

      <div class="panel">
        <form id="appForm" autocomplete="off">
          <div>
            <label>1. Your discord user id.*</label>
            <input id="discordId" name="discordId" type="text" required />
          </div>

          <div>
            <label>2. Your discord username.*</label>
            <input id="discordUsername" name="discordUsername" type="text" required />
          </div>

          <div>
            <label>3. Your email.*</label>
            <input id="email" name="email" type="email" required />
          </div>

          <div>
            <label>4. Choose what you want to join as?*</label>
            <div class="select-wrap">
              <select id="teamChoice" name="teamChoice" required>
                <option value="" disabled selected>-- pick a team --</option>
                <option value="Chat Staff Team">Chat Staff Team</option>
                <option value="VC Staff Team">VC Staff Team</option>
                <option value="Gaming Staff Team">Gaming Staff Team</option>
              </select>
            </div>
          </div>

          <div>
            <label>5. Why you wanna join us?*</label>
            <textarea id="whyJoin" name="whyJoin" required></textarea>
          </div>

          <div>
            <label>6. Are you current mod anywhere?*</label>
            <div class="row">
              <label style="display:flex;align-items:center;gap:8px"><input type="radio" name="isModAnywhere" value="Yes" required> Yes</label>
              <label style="display:flex;align-items:center;gap:8px"><input type="radio" name="isModAnywhere" value="No" required> No</label>
            </div>
          </div>

          <div>
            <label>7. What is your experience?* (number only + unit)</label>
            <div class="row">
              <input id="experienceNumber" name="experienceNumber" type="number" placeholder="e.g. 6" required style="flex:1" min="0" step="1">
              <select id="experienceUnit" name="experienceUnit" required style="width:150px">
                <option value="months">Months</option>
                <option value="days">Days</option>
                <option value="years">Years</option>
              </select>
            </div>
          </div>

          <div>
            <label>8. Wanna say something</label>
            <textarea id="extraMessage" name="extraMessage" placeholder="Optional message..."></textarea>
          </div>

          <div>
            <label>CAPTCHA: <span id="captchaQuestion">...</span> *</label>
            <div class="row">
              <input id="captchaAnswer" name="captchaAnswer" type="text" placeholder="answer" required style="flex:1">
              <button type="button" id="regen" class="btn" style="background:transparent;color:var(--neon);border:1px solid rgba(255,255,255,0.04);">New</button>
            </div>
            <input type="hidden" id="captchaToken">
          </div>

          <div style="display:flex;gap:12px;align-items:center;margin-top:6px">
            <button id="submitBtn" class="btn" type="submit">Submit Application</button>
            <div id="msg" class="muted"></div>
          </div>

          <div class="footer" style="margin-top:10px;color:var(--muted);font-size:13px">
            <em>Note:</em> This page is single-file (client-side). For reliable IP bans, webhooks and anti-spam you should use a small server — browser restrictions (CORS) might block direct webhook requests.
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // ---------- CONFIG ----------
    const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1434902352820699186/R_l_4eMPPU0G7fUe2-QG3S9-uHYDntE8fAk0In4JL8GtFjoJKjsCcK-NCnd7DdWlwo7V';
    const RATE_LIMIT_MS = 48 * 60 * 60 * 1000; // 48 hours
    const SUBMIT_KEY = 'chillx_last_submit_v1';

    // ---------- small utilities ----------
    function qs(id){return document.getElementById(id)}
    function setStatus(text, cls){const s = qs('status'); s.textContent = text; s.className = 'capsule ' + (cls||'muted')}

    // ---------- captcha (client side) ----------
    let captchaObj = {token:null, answer:null, question:null, created:0};
    function genCaptcha(){
      const a = Math.floor(Math.random()*12)+1;
      const b = Math.floor(Math.random()*12)+1;
      const ops = ['+','-'];
      const op = ops[Math.floor(Math.random()*ops.length)];
      const q = `${a} ${op} ${b}`;
      const ans = op==='+'? a+b : a-b;
      captchaObj = { token: Math.random().toString(36).slice(2), question: q, answer: String(ans), created: Date.now() };
      qs('captchaQuestion').textContent = q + ' = ?';
      qs('captchaToken').value = captchaObj.token;
    }

    // ---------- IP & geo (client-side best-effort) ----------
    async function fetchIpGeo(){
      try{
        const r = await fetch('https://ipapi.co/json/');
        if (!r.ok) throw new Error('geo failed');
        const j = await r.json();
        return { ip: j.ip || j.network || 'unknown', city: j.city, region: j.region, country: j.country_name, lat: j.latitude || j.lat, lon: j.longitude || j.lon, isp: j.org };
      }catch(e){
        try{ const r2 = await fetch('https://api.ipify.org?format=json'); if(r2.ok){ const j=await r2.json(); return { ip: j.ip }; } }
        catch(e2){}
        return { ip: 'unknown' };
      }
    }

    // ---------- rate check ----------
    function checkRate(){
      const last = localStorage.getItem(SUBMIT_KEY);
      if(!last) return false;
      const diff = Date.now() - Number(last);
      return diff < RATE_LIMIT_MS;
    }
    function msToH(ms){ const s = Math.ceil(ms/1000); const h = Math.floor(s/3600); const m = Math.floor((s%3600)/60); const sec = s%60; return `${h}h ${m}m ${sec}s`; }

    // ---------- form submit ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      setStatus('Ready');
      genCaptcha();

      // restore ban state
      if (checkRate()){
        const last = Number(localStorage.getItem(SUBMIT_KEY));
        const left = RATE_LIMIT_MS - (Date.now() - last);
        qs('submitBtn').disabled = true;
        qs('msg').innerHTML = '<span class="error">You have recently submitted. Try again in '+msToH(left)+'</span>';
      }

      qs('regen').addEventListener('click', ()=>{ genCaptcha(); qs('captchaAnswer').value = ''; });

      qs('appForm').addEventListener('submit', async (e)=>{
        e.preventDefault();
        qs('msg').textContent = '';
        if (checkRate()){ qs('msg').innerHTML = '<span class="error">Rate limited. One submission per 48 hours.</span>'; return; }

        // gather values
        const discordId = qs('discordId').value.trim();
        const discordUsername = qs('discordUsername').value.trim();
        const email = qs('email').value.trim();
        const teamChoice = qs('teamChoice').value;
        const whyJoin = qs('whyJoin').value.trim();
        const isModAnywhere = document.querySelector('input[name="isModAnywhere"]:checked')?.value || 'No';
        const experienceNumberRaw = qs('experienceNumber').value.trim();
        const experienceUnit = qs('experienceUnit').value;
        const extraMessage = qs('extraMessage').value.trim();
        const captchaAnswer = qs('captchaAnswer').value.trim();

        // client-side validations
        if(!discordId||!discordUsername||!email||!teamChoice||!whyJoin||experienceNumberRaw===''){
          qs('msg').innerHTML = '<span class="error">Please fill all required fields.</span>'; return; }

        // Only digits allowed (no decimals, no signs). This fixes PC locale issues.
        if(!/^\\d+$/.test(experienceNumberRaw)){
          qs('msg').innerHTML = '<span class="error">Experience must be a whole number (0,1,2...).</span>'; return; }
        const experienceNumber = parseInt(experienceNumberRaw, 10);

        // verify captcha client-side
        if(String(captchaAnswer) !== String(captchaObj.answer)){
          qs('msg').innerHTML = '<span class="error">Captcha wrong. Try new one.</span>';
          genCaptcha(); return;
        }

        // disable UI
        qs('submitBtn').disabled = true; qs('submitBtn').textContent = 'Sending...';

        // fetch ip & geo
        const geo = await fetchIpGeo();
        const istTime = new Date().toLocaleString('en-GB', { timeZone: 'Asia/Kolkata' });

        // prepare discord embed payload (webhook)
        const embed = {
          title: 'New Staff Application — Chill X',
          color: 0x00ffd5,
          fields: [
            { name: 'Discord ID', value: discordId, inline: true },
            { name: 'Discord Username', value: discordUsername, inline: true },
            { name: 'Email', value: email, inline: true },
            { name: 'Team Applying For', value: teamChoice, inline: true },
            { name: 'Why join', value: whyJoin.slice(0,1024) },
            { name: 'Currently Mod Anywhere?', value: isModAnywhere, inline: true },
            { name: 'Experience', value: experienceNumber + ' ' + experienceUnit, inline: true },
            { name: 'Extra Message', value: extraMessage || '—' }
          ],
          footer: { text: `IP: ${geo.ip || 'unknown'} · IST: ${istTime}` },
          timestamp: new Date().toISOString()
        };
        if(geo.city || geo.region || geo.country){ embed.fields.push({ name: 'IP Location', value: `${geo.city||'-'}, ${geo.region||'-'}, ${geo.country||'-'} · ISP: ${geo.isp||'-'}` }); }
        if(geo.lat && geo.lon){ embed.url = `https://www.google.com/maps/search/?api=1&query=${geo.lat},${geo.lon}`; }

        const payload = { embeds: [embed] };

        try{
          const resp = await fetch(DISCORD_WEBHOOK_URL, { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify(payload) });
          if (!resp.ok){ throw new Error('webhook_failed '+resp.status); }
          // mark local storage to limit resubmission
          localStorage.setItem(SUBMIT_KEY, Date.now().toString());
          qs('msg').innerHTML = '<span class="success">Submitted! Your application has been sent.</span>';
          setStatus('Submitted', 'success');
        }catch(err){
          console.error(err);
          qs('msg').innerHTML = '<span class="error">Failed to send — browser may block direct webhook calls (CORS). Use a small server proxy if this fails.</span>';
          setStatus('Failed', 'error');
        }finally{
          qs('submitBtn').disabled = true; qs('submitBtn').textContent = 'Submitted';
        }
      });

    });

    // ---------- light tamper-deterrence (cosmetic, not secure) ----------
    (function(){
      document.addEventListener('contextmenu', e => e.preventDefault());
      document.addEventListener('keydown', function(e){
        if (e.key === 'F12') e.preventDefault();
        if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C')) e.preventDefault();
        if (e.ctrlKey && (e.key === 'U' || e.key === 'S')) e.preventDefault();
      });
      document.addEventListener('mousedown', function(e){ if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA' && e.button === 2) e.preventDefault(); }, true);
    })();
  </script>
</body>
</html>
